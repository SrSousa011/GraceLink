pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                script {
                    // Checkout do repositório Git
                    checkout([$class: 'GitSCM', 
                        branches: [[name: '*/main']],
                        userRemoteConfigs: [[url: 'https://github.com/SrSousa011/GraceLink.git']]
                    ])
                }
            }
        }

        stage('Clean Workspace') {
            steps {
                // Limpeza do workspace
                cleanWs()
            }
        }

        stage('Flutter Clean') {
            steps {
                // Executa o flutter clean
                bat 'flutter clean'
            }
        }

        stage('Install Dependencies') {
            steps {
                // Instala as dependências do Flutter
                bat 'flutter pub get'
            }
        }

        stage('Run Tests') {
            steps {
                // Executa os testes do Flutter
                bat 'flutter test'
            }
        }

        stage('Build App Bundle') {
            steps {
                // Gera o app bundle com o comando --release
                bat 'flutter build appbundle --release'
            }
        }

        stage('Success') {
            steps {
                script {
                    // Notifica ou registra que a pipeline foi concluída com sucesso
                    echo "Pipeline executed successfully!"
                }
            }
        }
    }
    post {
        success {
            script {
                // Ação adicional após sucesso, como enviar notificação
                echo "Build and tests succeeded!"
            }
        }
        failure {
            script {
                // Ação adicional após falha, como envio de alerta
                echo "Build or tests failed. Check the logs for details."
            }
        }
    }
}
